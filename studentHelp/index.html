<!DOCTYPE html>
<html lang="en">
<link href="studentHelp.css" rel="stylesheet">

<head>
    <meta charset="utf-8">
    <title>E13 NSS Student Help</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <header>
        <div id='intro'>Okay! Before you submit a ticket for help, let's ask some questions that might help. </div>
    </header>

    <div id="usernameQuestion" class="hidden question">
        <label for="username">What is your name?</label>
        <textarea id='username' type='text'></textarea>
    </div>
    <div id="describeQuestion" class="hidden question">
        <label for="describe">Describe the Problem.</label>
        <div class='example'> **NOT ACCEPTABLE:** "Everything is broken!" ❌</div>
        <div class="example">**ACCEPTABLE:** "When I click on my edit button, my animal's information doesn't show
            up in the animal
            edit form" ✔
        </div>
        <textarea id='describe' type='text'></textarea>
    </div>
    <div id="refsQuestion" class="hidden question">
        <label for="refs">What have you Googled? Have you used any other references?</label>
        <div class="example">Ex: "how to get data to show up in a form from another component in react"</div>
        <textarea id='refs' type='text'></textarea>
    </div>
    <div id="errorsQuestion" class="hidden">
        <label for="errors">Have you used your console.logs? Debugger? If so, what is your error message?</label>
        <div class="example">Ex: 'useState' is not defined</div>
        <textarea id='errors' type='text'></textarea>
    </div>
    <div id="otherQuestion" class="hidden">
        <label for="other">Have you talked to a classmate or tried to rubberduck it out? What else have you tried?</label>
        <textarea id='other' type='text'></textarea>
    </div>
    <div id="codeQuestion" class="hidden">
        <label for="code">Do you have a code snippet?</label>
        <textarea id='code' type='text'></textarea>
    </div>
    <div id="end" class="hidden">Copy the markdown below, hit the Continue button, and paste it into the issue box.
        <div id='templateBox'></div>
    </div>
    <button id='nextQuestion'>Continue</button>
    <script src="index.js"></script>

    <script>
        let global;

        // Variables
        let nextQuestion = document.querySelector('#nextQuestion');
        var allInput = document.querySelectorAll('textarea');

        // Click Handlers
        // When the Continue button is clicked, input data is saved in session storage for final reporting.
        let checkAndSaveData = function () {

            for (let i = 0; i < allInput.length; i++) {
                // Check if data is in storage, if so, skip it.
                if (sessionStorage.getItem(allInput[i].value)) continue;

                // Set storage for a completed field
                sessionStorage.setItem(allInput[i].id, allInput[i].value);

                // If we haven't answered a question go directly to that one.
                if (!sessionStorage.getItem(allInput[i].id)) {
                    let nextQuestionToDisplay = allInput[i].id;
                    return nextQuestionToDisplay;
                };
            }
        }

        // When the continue button is clicked, display the next node
        let displayNextQuestion = function (event) {
            let introText = document.getElementById('intro');
            let nextQuestionToDisplay = checkAndSaveData();
            let nextQuestion = document.getElementById(nextQuestionToDisplay + 'Question');
            let end = document.getElementById('end');

            // Hide the intro text, if it isn't already hidden.
            if (introText.classList.value !== 'hidden') {
                introText.classList.add('hidden');
            }
            
            console.log(nextQuestion)
            if (nextQuestion) {
                // Show the next question
                nextQuestion.classList.remove("hidden");

                // Put your focus on the next input element
                document.getElementById(nextQuestionToDisplay).focus();
            } else {
                // Hide all the previous questions since we are going to display the help ticket
                for (let j = 0; j < allInput.length; j++) {
                    let eachQuestion = document.getElementById(allInput[j].id + 'Question');
                    eachQuestion.classList.add('hidden');
                }

                // Put the help ticket on screen
                document.getElementById('templateBox').innerHTML = generateHelpTicket();

                // Redirect the continue button to Github
                document.getElementById('nextQuestion').addEventListener('click', function () {
                    location.href = 'https://github.com/nss-evening-cohort-13/student-help/issues/new?assignees=&labels=help+wanted&template=help-me-template.md&title='
                }, false)

                // Show the final page
                end.classList.remove("hidden");

                // Clear the sessionStorage
                sessionStorage.clear();
            }
        }
        nextQuestion.addEventListener('click', displayNextQuestion, false);

        let generateHelpTicket = function () {
            let username = sessionStorage.getItem('username');
            let describe = sessionStorage.getItem('describe');
            let errors = sessionStorage.getItem('errors');
            let refs = sessionStorage.getItem('refs');
            let other = sessionStorage.getItem('other');
            let code = sessionStorage.getItem('code');

            let markup =
                `<div class="markdown">
                <div>#### Name: ${username} </div>
                <div>#### Describe your issue: </div> 
                <div>${describe}</div>

                <div>#### List any error messages that appear: </div>
                <div>${errors}</div>

                <div>#### What have you googled or used for references? </div>
                <div>${refs}</div>

                <div>#### What else have you tried? </div>
                <div>${other}</div>

                <div>#### Code Snippet (If applicable) </div>
                <div>\`${code}\`</div>
                </div>`;
            document.getElementById('templateBox').append(markup);

            return markup;
        }
    </script>

</body>

</html>